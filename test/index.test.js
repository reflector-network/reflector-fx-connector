/*eslint-disable no-undef */
const nock = require('nock')
const {setGateway, getTradesData} = require('../src')
const PriceProviderBase = require('../src/providers/price-provider-base')
const {assets, getTimestamp} = require('./test-utils')

const proxies = [
    'http://proxy.com:8081',
    'http://proxy.com:8082'
]

describe('index', () => {

    const timeframe = 60
    const count = 100
    const timestamp = getTimestamp() - (timeframe * count)

    it('get prices', async () => {
        const sources = {
            'apilayer': {apiKey: '22dfc689d2747a1c8dd8effd06f44771'},
            'nbp': {},
            'ecb': {},
            'abstractapi': {apiKey: 'mock'},
            'exchangerate': {apiKey: 'mock'},
            'forexrateapi': {apiKey: 'mock'},
            'fxratesapi': {apiKey: 'mock'}
        }
        const tradesData = await getTradesData(assets, 'USD', timestamp, timeframe, count,
            {
                batchSize: 5,
                batchDelay: 1000,
                timeout: 15000,
                sources
            })
        expect(tradesData.length).toBe(count)
        expect(tradesData[tradesData.length - 1].length).toBe(assets.length)
        expect(tradesData[tradesData.length - 1][0].length).toBe(Object.entries(sources).length)
    }, 30000)


    it('set gateway', () => {
        setGateway(proxies, true)
        expect(PriceProviderBase.gatewayUrls.length).toBe(proxies.length)
        setGateway(null)
        expect(PriceProviderBase.gatewayUrls).toBeNull()
    }, 30000)


    beforeAll(() => {
        nock('https://api.fxratesapi.com/')
            .persist()
            .get(() => true)
            .reply(200, {
                "success":true,"terms":"https://fxratesapi.com/legal/terms-conditions","privacy":"https://fxratesapi.com/legal/privacy-policy","timestamp":1743520740,"date":"2025-04-01T15:19:00.000Z","base":"USD","rates":{"ADA":1.4522147122,"AED":3.6716705601,"AFN":71.488691567,"ALL":91.6814425012,"AMD":389.7432056913,"ANG":1.7885702923,"AOA":909.0566026506,"ARB":2.9494917734,"ARS":1072.5817469298,"AUD":1.5919201682,"AWG":1.79,"AZN":1.7,"BAM":1.808320315,"BBD":2,"BDT":121.5494159161,"BGN":1.8070003177,"BHD":0.376,"BIF":2917.1009644319,"BMD":1,"BNB":0.0016221629,"BND":1.341440164,"BOB":6.923521005,"BRL":5.6856907445,"BSD":1,"BTC":0.0000117829,"BTN":82.3914057382,"BWP":13.7026416622,"BYN":3.2704426949,"BYR":32704.428174298,"BZD":2,"CAD":1.4312001991,"CDF":2857.4438302786,"CHF":0.8824501315,"CLF":0.0239000027,"CLP":945.0225246143,"CNY":7.2627811882,"COP":4137.7926384145,"CRC":497.6413862882,"CUC":1,"CUP":24,"CVE":102.1494635133,"CZK":23.0744325756,"DAI":0.999336253,"DJF":177.721,"DKK":6.9028113531,"DOP":63.0050611602,"DOT":0.2347458336,"DZD":134.4499648536,"EGP":50.4970369139,"ERN":15,"ETB":129.9337309566,"ETH":0.000524277,"EUR":0.9251801304,"FJD":2.3167903041,"FKP":0.7735141264,"GBP":0.7734601246,"GEL":2.7647704192,"GGP":0.7735138085,"GHS":15.4324022347,"GIP":0.7735138827,"GMD":71.4005897444,"GNF":8654.5657011269,"GTQ":7.6916010736,"GYD":209.8036503786,"HKD":7.7778515388,"HNL":25.6077549116,"HRK":6.5477309675,"HTG":132.5078107572,"HUF":372.1670502412,"IDR":16514.786409163,"ILS":3.6960405988,"IMP":0.7735138035,"INR":85.5130911307,"IQD":1306.3912685471,"IRR":41948.508974654,"ISK":131.9277194059,"JEP":0.7735134696,"JMD":157.2268611403,"JOD":0.71,"JPY":149.3638507918,"KES":129.2535925841,"KGS":86.6075333434,"KHR":3989.1412697726,"KMF":455.81918436,"KPW":900.0075749738,"KRW":1469.6612078193,"KWD":0.3079100424,"KYD":0.83333,"KZT":502.2438774165,"LAK":21530.606145987,"LBP":89415.195286665,"LKR":295.7359404417,"LRD":199.5769475226,"LSL":18.3031026344,"LTC":0.0118086183,"LTL":3.1945338142,"LVL":0.6502312337,"LYD":4.8263505237,"MAD":9.6118817094,"MDL":17.7640032112,"MGA":4643.6751546427,"MKD":56.8509391406,"MMK":2095.4994658956,"MNT":3481.0663709497,"MOP":7.9936415392,"MRO":356.999828,"MUR":45.3571583941,"MVR":15.4469416075,"MWK":1731.0215072271,"MXN":20.3588129336,"MYR":4.4298004912,"MZN":63.4408271046,"NAD":18.3447923488,"NGN":1534.1446856807,"NIO":36.7533091484,"NOK":10.4442019076,"NPR":136.5329009389,"NZD":1.7534301964,"OMR":0.3836000685,"OP":1.3023282969,"PAB":0.9989601005,"PEN":3.6688506423,"PGK":4.0871006522,"PHP":57.2284690327,"PKR":279.6881956656,"PLN":3.8676007571,"PYG":8004.1625270871,"QAR":3.6345306171,"RON":4.6034106195,"RSD":107.7508610789,"RUB":84.3513540479,"RWF":1407.8307453961,"SAR":3.7438406099,"SBD":8.4862971456,"SCR":14.8692523717,"SDG":601.5,"SEK":9.9865414197,"SGD":1.3424201492,"SHP":0.7734601381,"SLL":22656.764194169,"SOL":0.007771705,"SOS":571.1267905061,"SRD":36.7599748007,"STD":22820.018235047,"SVC":8.75,"SYP":13002.260138032,"SZL":18.363592303,"THB":34.1261859611,"TJS":10.9047914705,"TMT":3.5,"TND":3.0964705599,"TOP":2.392990434,"TRY":37.8876852124,"TTD":6.7427907556,"TWD":33.2574352309,"TZS":2613.8886885632,"UAH":41.4863666157,"UGX":3652.5076586716,"USD":1,"UYU":42.1040582275,"UZS":12880.371138203,"VEF":6958638.0193561,"VND":25582.149748179,"VUV":123.3585451332,"WST":2.8360766114,"XAF":606.6796867507,"XAG":0.0295080576,"XAU":0.0003194369,"XCD":2.7,"XDR":0.750250106,"XOF":606.679672008,"XPD":0.0010067165,"XPF":110.2777657523,"XPT":0.0010068485,"XRP":0.4616169504,"YER":244.9481794697,"ZAR":18.3790631012,"ZMK":9001.2,"ZMW":28.0182452413,"ZWL":68210.914979217}
            })

        nock('https://api.forexrateapi.com/')
            .persist()
            .get(() => true)
            .reply(200, {
                "success":true,"base":"USD","timestamp":1743465599,"rates":{"ADA":1.5126212069,"AED":3.6730815274,"AFN":70.2089775,"ALL":91.278995,"AMD":388.727836,"ANG":1.7853238938,"AOA":913.1362123747,"ARS":1066.0811685,"AUD":1.5926814136,"AZN":1.696591,"BAM":1.802336,"BBD":1.997704,"BDT":120.2479955,"BGN":1.807581,"BHD":0.3770361728,"BIF":2932.5386565,"BNB":0.0016612249,"BND":1.3427465718,"BOB":6.83629,"BRL":5.7603843318,"BSD":0.9937856943,"BTC":0.0000121452,"BTN":84.550172,"BWP":13.516409,"BYN":3.237842,"BZD":2.0025202712,"CAD":1.4315170053,"CDF":2889.49969,"CHF":0.8804276989,"CLF":0.024336762,"CLP":950.4301711027,"CNY":7.266401282,"COP":4127.58,"CRC":494.4201035,"CVE":101.6950824844,"CZK":23.0321968791,"DJF":176.0095925,"DKK":6.8925826094,"DOP":62.4478805,"DOT":0.2473344888,"DZD":133.019759,"EGP":50.6049944831,"ERN":15,"ETB":129.984393,"ETH":0.000553667,"EUR":0.9238103788,"FJD":2.3251,"FKP":0.772617,"GBP":0.7728666132,"GEL":2.754987,"GHS":15.3828657739,"GIP":0.7726475512,"GMD":71.4935523027,"GNF":8550.4292735043,"GTQ":7.7165749014,"GYD":208.9851614415,"HKD":7.7785147324,"HNL":25.639605892,"HRK":6.961903,"HTG":133.0815435857,"HUF":371.2769320867,"IDR":16606.2683939545,"ILS":3.6937222119,"INR":85.5376694342,"IQD":1310.4616267575,"IRR":42002.6932510215,"ISK":131.9783462748,"JMD":157.455521408,"JOD":0.7090545727,"JPY":149.451251,"KES":129.5330363782,"KGS":86.4000075,"KHR":3975.412045418,"KMF":455.3305573292,"KRW":1470.2036767527,"KWD":0.309347756,"KYD":0.8200071,"KZT":503.7973027657,"LAK":21610.5660452609,"LBP":89699.8478973636,"LKR":296.1692504028,"LRD":199.722675726,"LSL":17.9959381156,"LTC":0.0116164628,"LYD":4.809311,"MAD":9.6330626675,"MDL":17.8920875,"MGA":4651.1844038488,"MKD":56.5979155,"MMK":2098.1045227115,"MNT":3492.7382598345,"MOP":8.0111185232,"MRO":39.367,"MUR":45.7795806629,"MVR":15.4385845,"MWK":1733.2334925165,"MXN":20.3866213266,"MYR":4.4363692668,"MZN":63.5707548291,"NAD":18.2572399078,"NGN":1532.7244503008,"NIO":36.624356189,"NOK":10.4851089878,"NPR":136.8419609825,"NZD":1.7533554277,"OMR":0.3850235,"PAB":1.00565,"PEN":3.630441,"PHP":57.3780745,"PKR":278.6605505,"PLN":3.8578495,"PYG":7959.3209175,"QAR":3.6238165,"RON":4.5964625,"RSD":107.9394095,"RUB":84.904761,"RWF":1417.5505075,"SAR":3.7497855,"SCR":14.5507615,"SDG":598.896634,"SEK":10.00812,"SGD":1.3421175,"SLL":21830.2005415,"SOL":0.0080114417,"SOS":568.293174,"SRD":36.3777765,"STN":22.8648977465,"SVC":8.703246,"SZL":18.16727,"THB":33.954655,"TJS":10.8215025,"TMT":3.497114,"TND":3.0955305,"TOP":2.407309,"TRX":4.3143063015,"TRY":37.979525,"TTD":6.7498185,"TWD":33.2168465,"TZS":2616.190953,"UAH":41.3212395,"UGX":3643.694288,"UYU":42.195666,"UZS":12843.931134,"VES":69.335347,"VND":25552.5919495,"VUV":122.747289,"XAF":603.582383,"XCD":2.700031,"XOF":603.582383,"XPF":109.770601,"XRP":0.4679077091,"YER":245.6507425,"ZAR":18.428705,"ZMK":9001.193331,"ZMW":28.345987}
            })


        nock('https://v6.exchangerate-api.com/')
            .persist()
            .get(() => true)
            .reply(200, {
                "result":"success","documentation":"https://www.exchangerate-api.com/docs","terms_of_use":"https://www.exchangerate-api.com/terms","time_last_update_unix":1743519601,"time_last_update_utc":"Tue, 01 Apr 2025 15:00:01 +0000","time_next_update_unix":1743519901,"time_next_update_utc":"Tue, 01 Apr 2025 15:05:01 +0000","base_code":"USD","conversion_rates":{"USD":1,"AED":3.6725,"AFN":70.61543741,"ALL":91.65073128,"AMD":391.39855728,"ANG":1.79,"AOA":920.09996269,"ARS":1073.88,"AUD":1.59779932,"AWG":1.79,"AZN":1.7004296,"BAM":1.81048278,"BBD":2,"BDT":121.48791181,"BGN":1.81034859,"BHD":0.376,"BIF":2965.79633778,"BMD":1,"BND":1.34324352,"BOB":6.88618347,"BRL":5.70968383,"BSD":1,"BTN":85.61844027,"BWP":13.76512086,"BYN":3.13244173,"BZD":2,"CAD":1.4369077,"CDF":2859.34483274,"CHF":0.88261727,"CLP":948.79867657,"CNY":7.27417205,"COP":4150.2037641,"CRC":496.91550616,"CUP":24,"CVE":102.07067276,"CZK":23.11487131,"DJF":177.721,"DKK":6.90535766,"DOP":62.67770633,"DZD":133.81880216,"EGP":50.57628821,"ERN":15,"ETB":129.96008784,"EUR":0.92583668,"FJD":2.33359811,"FKP":0.77473311,"FOK":6.90514474,"GBP":0.77472197,"GEL":2.76514217,"GGP":0.77473311,"GHS":15.55316866,"GIP":0.77473311,"GMD":72.6355861,"GNF":8653.29550981,"GTQ":7.71534117,"GYD":209.57369532,"HKD":7.78109309,"HNL":25.51676264,"HRK":6.97457474,"HTG":130.82443054,"HUF":372.85416823,"IDR":16655.7988634,"ILS":3.70216211,"IMP":0.77473311,"INR":85.61044445,"IQD":1311.51642656,"IRR":42000.05549769,"ISK":133.14510803,"JEP":0.77473311,"JMD":156.44562692,"JOD":0.709,"JPY":149.39514249,"KES":129.19668226,"KGS":87.21148906,"KHR":4005.7146511,"KID":1.59779417,"KMF":455.4072391,"KRW":1471.33166102,"KWD":0.3083432,"KYD":0.833333,"KZT":503.63441488,"LAK":21548.55976078,"LBP":89500,"LKR":295.56204356,"LRD":199.40342927,"LSL":18.3777224,"LYD":4.8350564,"MAD":9.62950785,"MDL":17.96554368,"MGA":4674.06698698,"MKD":57.10722591,"MMK":2099.87881754,"MNT":3504.19167493,"MOP":8.01461771,"MRU":39.94973134,"MUR":45.73570409,"MVR":15.4470516,"MWK":1750.50635997,"MXN":20.45469633,"MYR":4.43739324,"MZN":63.91798807,"NAD":18.3777224,"NGN":1531.54261819,"NIO":36.6808229,"NOK":10.46583896,"NPR":136.98950444,"NZD":1.75884602,"OMR":0.384497,"PAB":1,"PEN":3.6664543,"PGK":4.087822,"PHP":57.28487405,"PKR":280.34052265,"PLN":3.87456035,"PYG":7962.69651812,"QAR":3.64,"RON":4.61025663,"RSD":108.5778698,"RUB":84.12694665,"RWF":1432.58781141,"SAR":3.75,"SBD":8.13392092,"SCR":14.32531388,"SDG":516.69654747,"SEK":10.0046786,"SGD":1.34318842,"SHP":0.77473311,"SLE":22.79877677,"SLL":22798.77679,"SOS":571.43532299,"SRD":36.80236314,"SSP":4451.05727446,"STN":22.67928611,"SYP":12990.63993283,"SZL":18.3777224,"THB":34.13686325,"TJS":10.90804429,"TMT":3.50000283,"TND":3.10474571,"TOP":2.38208189,"TRY":37.94472629,"TTD":6.7668757,"TVD":1.59779417,"TWD":33.22188078,"TZS":2653.02321118,"UAH":41.3916221,"UGX":3656.75322418,"UYU":41.88699533,"UZS":12925.45536507,"VES":69.776,"VND":25639.7750427,"VUV":122.01124543,"WST":2.82464916,"XAF":607.20965213,"XCD":2.7,"XCG":1.79,"XDR":0.7524942,"XOF":607.20965213,"XPF":110.46385999,"YER":246.07836788,"ZAR":18.37879641,"ZMW":28.071798,"ZWL":26.772}
            })

        nock('https://exchange-rates.abstractapi.com/')
            .persist()
            .get(() => true)
            .reply(200, {
                "base":"USD","last_updated":1743340500,"exchange_rates":{"EUR":0.924642,"JPY":149.422099,"BGN":1.808414,"CZK":23.080906,"DKK":6.899029,"GBP":0.772409,"HUF":372.029589,"PLN":3.868701,"RON":4.602034,"SEK":10.031438,"CHF":0.881276,"ISK":131.946371,"NOK":10.552936,"HRK":7.06591,"RUB":105,"TRY":37.947203,"AUD":1.601294,"BRL":5.779658,"CAD":1.436246,"CNY":7.253074,"HKD":7.779011,"IDR":16637.050393,"ILS":3.722238,"INR":85.432732,"KRW":1474.535368,"MXN":20.400092,"MYR":4.43754,"NZD":1.760055,"PHP":57.25289,"SGD":1.342487,"THB":33.939898,"ZAR":18.380213,"ARS":75.269373,"DZD":124.445887,"MAD":8.83269,"TWD":27.466513,"BTC":0.000023,"ETH":0.000392,"BNB":0.003347,"DOGE":12.544233,"XRP":1.745786,"BCH":0.003818,"LTC":0.013802}
            })

        nock('https://apilayer.net/')
            .persist()
            .get(() => true)
            .reply(200, {
                "success":true,"terms":"https://currencylayer.com/terms","privacy":"https://currencylayer.com/privacy","timestamp":1743520033,"source":"USD","quotes":{"USDAED":3.67305,"USDAFN":71.823614,"USDALL":92.008765,"USDAMD":391.099145,"USDANG":1.790208,"USDAOA":912.000086,"USDARS":1072.970302,"USDAUD":1.593346,"USDAWG":1.8,"USDAZN":1.697124,"USDBAM":1.812084,"USDBBD":2.020115,"USDBDT":121.58694,"USDBGN":1.809502,"USDBHD":0.37691,"USDBIF":2973.487568,"USDBMD":1,"USDBND":1.343828,"USDBOB":6.913965,"USDBRL":5.68802,"USDBSD":1.000468,"USDBTC":0.000011854852,"USDBTN":85.719977,"USDBWP":13.734602,"USDBYN":3.274144,"USDBYR":19600,"USDBZD":2.009645,"USDCAD":1.431965,"USDCDF":2869.999996,"USDCHF":0.882785,"USDCLF":0.024468,"USDCLP":938.880297,"USDCNY":7.257702,"USDCNH":7.280115,"USDCOP":4170.37,"USDCRC":500.419255,"USDCUC":1,"USDCUP":26.5,"USDCVE":102.162493,"USDCZK":23.090981,"USDDJF":178.170851,"USDDKK":6.906039,"USDDOP":63.309846,"USDDZD":133.85389,"USDEGP":50.56668,"USDERN":15,"USDETB":132.445439,"USDEUR":0.925575,"USDFJD":2.33545,"USDFKP":0.77197,"USDGBP":0.773945,"USDGEL":2.759885,"USDGGP":0.77197,"USDGHS":15.494655,"USDGIP":0.77197,"USDGMD":72.115383,"USDGNF":8624.768245,"USDGTQ":7.713897,"USDGYD":209.199067,"USDHKD":7.781015,"USDHNL":25.522712,"USDHRK":6.970901,"USDHTG":130.612961,"USDHUF":371.694811,"USDIDR":16626.30907,"USDILS":3.69539,"USDIMP":0.77197,"USDINR":85.431739,"USDIQD":1304.446882,"USDIRR":42083.2246,"USDISK":131.877826,"USDJEP":0.77197,"USDJMD":156.542404,"USDJOD":0.709018,"USDJPY":149.432023,"USDKES":129.27919,"USDKGS":86.529033,"USDKHR":3977.946177,"USDKMF":454.642364,"USDKPW":899.983053,"USDKRW":1473.977044,"USDKWD":0.308263,"USDKYD":0.831621,"USDKZT":503.388248,"USDLAK":21531.062052,"USDLBP":89376.297544,"USDLKR":295.432755,"USDLRD":199.412701,"USDLSL":18.36781,"USDLTL":2.95274,"USDLVL":0.60489,"USDLYD":4.804346,"USDMAD":9.629875,"USDMDL":17.978055,"USDMGA":4643.604504,"USDMKD":56.838331,"USDMMK":2099.285815,"USDMNT":3491.774727,"USDMOP":8.011997,"USDMRU":39.431798,"USDMUR":45.650618,"USDMVR":15.439318,"USDMWK":1729.241666,"USDMXN":20.373695,"USDMYR":4.43521,"USDMZN":63.886412,"USDNAD":18.36781,"USDNGN":1534.903958,"USDNIO":36.681264,"USDNOK":10.453497,"USDNPR":136.754855,"USDNZD":1.754432,"USDOMR":0.384982,"USDPAB":1,"USDPEN":3.658403,"USDPGK":4.070731,"USDPHP":57.251389,"USDPKR":280.07878,"USDPLN":3.8662,"USDPYG":7947.514594,"USDQAR":3.639939,"USDRON":4.599798,"USDRSD":108.312701,"USDRUB":84.837237,"USDRWF":1417.448597,"USDSAR":3.750128,"USDSBD":8.499909,"USDSCR":14.316276,"USDSDG":600.486375,"USDSEK":9.99567,"USDSGD":1.341864,"USDSHP":0.785843,"USDSLE":22.785015,"USDSLL":20969.501083,"USDSOS":571.138552,"USDSRD":36.554782,"USDSTD":20697.981008,"USDSVC":8.749924,"USDSYP":13001.855134,"USDSZL":18.36781,"USDTHB":33.919916,"USDTJS":10.882761,"USDTMT":3.499003,"USDTND":3.108816,"USDTOP":2.408453,"USDTRY":37.909265,"USDTTD":6.7802,"USDTWD":33.21481,"USDTZS":2649.216491,"USDUAH":41.384605,"USDUGX":3659.778507,"USDUYU":42.165898,"USDUZS":12880.822068,"USDVES":69.205856,"USDVND":25581.380556,"USDVUV":123.240574,"USDWST":2.827766,"USDXAF":606.189819,"USDXAG":0.029437,"USDXAU":0.000319,"USDXCD":2.707331,"USDXDR":0.754365,"USDXOF":606.189819,"USDXPF":110.278093,"USDYER":246.013769,"USDZAR":18.38389,"USDZMK":9001.203496,"USDZMW":28.159635,"USDZWL":321.999592}
            })

        nock('https://data-api.ecb.europa.eu/')
            .persist()
            .get(() => true)
            .reply(200, {
                "header":{"id":"a7b7aa9d-36b3-4a7a-9f9b-c8b17a94b6f8","test":false,"prepared":"2025-04-01T17:09:52.262+02:00","sender":{"id":"ECB"}},"dataSets":[{"action":"Replace","validFrom":"2025-04-01T17:09:52.262+02:00","series":{"0:0:0:0:0":{"observations":{"0":[1.7255]}},"0:1:0:0:0":{"observations":{"0":[1.9558]}},"0:2:0:0:0":{"observations":{"0":[6.1679]}},"0:3:0:0:0":{"observations":{"0":[1.5529]}},"0:4:0:0:0":{"observations":{"0":[0.952]}},"0:5:0:0:0":{"observations":{"0":[7.8431]}},"0:6:0:0:0":{"observations":{"0":[24.954]}},"0:7:0:0:0":{"observations":{"0":[7.4616]}},"0:8:0:0:0":{"observations":{"0":[0.83665]}},"0:9:0:0:0":{"observations":{"0":[8.3943]}},"0:10:0:0:0":{"observations":{"0":[402.63]}},"0:11:0:0:0":{"observations":{"0":[18062.4]}},"0:12:0:0:0":{"observations":{"0":[3.9973]}},"0:13:0:0:0":{"observations":{"0":[92.384]}},"0:14:0:0:0":{"observations":{"0":[143.7]}},"0:15:0:0:0":{"observations":{"0":[160.93]}},"0:16:0:0:0":{"observations":{"0":[1588.43]}},"0:17:0:0:0":{"observations":{"0":[22.138]}},"0:18:0:0:0":{"observations":{"0":[4.7872]}},"0:19:0:0:0":{"observations":{"0":[11.318]}},"0:20:0:0:0":{"observations":{"0":[1.9001]}},"0:21:0:0:0":{"observations":{"0":[61.794]}},"0:22:0:0:0":{"observations":{"0":[4.1863]}},"0:23:0:0:0":{"observations":{"0":[4.9774]}},"0:24:0:0:0":{"observations":{"0":[10.816]}},"0:25:0:0:0":{"observations":{"0":[1.4492]}},"0:26:0:0:0":{"observations":{"0":[36.846]}},"0:27:0:0:0":{"observations":{"0":[40.9201]}},"0:28:0:0:0":{"observations":{"0":[1.0788]}},"0:29:0:0:0":{"observations":{"0":[19.7741]}}}}],"structure":{"links":[{"title":"Exchange Rates","rel":"dataflow","href":"http://data-api.ecb.europa.eu:80/service/dataflow/ECB/EXR/1.0"}],"name":"Exchange Rates","dimensions":{"series":[{"id":"FREQ","name":"Frequency","values":[{"id":"D","name":"Daily"}]},{"id":"CURRENCY","name":"Currency","values":[{"id":"AUD","name":"Australian dollar"},{"id":"BGN","name":"Bulgarian lev"},{"id":"BRL","name":"Brazilian real"},{"id":"CAD","name":"Canadian dollar"},{"id":"CHF","name":"Swiss franc"},{"id":"CNY","name":"Chinese yuan renminbi"},{"id":"CZK","name":"Czech koruna"},{"id":"DKK","name":"Danish krone"},{"id":"GBP","name":"UK pound sterling"},{"id":"HKD","name":"Hong Kong dollar"},{"id":"HUF","name":"Hungarian forint"},{"id":"IDR","name":"Indonesian rupiah"},{"id":"ILS","name":"Israeli shekel"},{"id":"INR","name":"Indian rupee"},{"id":"ISK","name":"Iceland krona"},{"id":"JPY","name":"Japanese yen"},{"id":"KRW","name":"Korean won (Republic)"},{"id":"MXN","name":"Mexican peso"},{"id":"MYR","name":"Malaysian ringgit"},{"id":"NOK","name":"Norwegian krone"},{"id":"NZD","name":"New Zealand dollar"},{"id":"PHP","name":"Philippine peso"},{"id":"PLN","name":"Polish zloty"},{"id":"RON","name":"Romanian leu"},{"id":"SEK","name":"Swedish krona"},{"id":"SGD","name":"Singapore dollar"},{"id":"THB","name":"Thai baht"},{"id":"TRY","name":"Turkish lira"},{"id":"USD","name":"US dollar"},{"id":"ZAR","name":"South African rand"}]},{"id":"CURRENCY_DENOM","name":"Currency denominator","values":[{"id":"EUR","name":"Euro"}]},{"id":"EXR_TYPE","name":"Exchange rate type","values":[{"id":"SP00","name":"Spot"}]},{"id":"EXR_SUFFIX","name":"Series variation - EXR context","values":[{"id":"A","name":"Average"}]}],"observation":[{"id":"TIME_PERIOD","name":"Time period or range","role":"time","values":[{"id":"2025-04-01","name":"2025-04-01","start":"2025-04-01T00:00:00.000+02:00","end":"2025-04-01T23:59:59.999+02:00"}]}]}}
            })


        nock('https://api.nbp.pl/api/exchangerates/tables/A/?format=json')
            .persist()
            .get(() => true)
            .reply(200, [
                {"table":"A","no":"063/A/NBP/2025","effectiveDate":"2025-04-01","rates":[{"currency":"bat (Tajlandia)","code":"THB","mid":0.1133},{"currency":"dolar amerykański","code":"USD","mid":3.8656},{"currency":"dolar australijski","code":"AUD","mid":2.4186},{"currency":"dolar Hongkongu","code":"HKD","mid":0.4968},{"currency":"dolar kanadyjski","code":"CAD","mid":2.6879},{"currency":"dolar nowozelandzki","code":"NZD","mid":2.1953},{"currency":"dolar singapurski","code":"SGD","mid":2.8799},{"currency":"euro","code":"EUR","mid":4.1818},{"currency":"forint (Węgry)","code":"HUF","mid":0.010379},{"currency":"frank szwajcarski","code":"CHF","mid":4.3800},{"currency":"funt szterling","code":"GBP","mid":4.9968},{"currency":"hrywna (Ukraina)","code":"UAH","mid":0.0934},{"currency":"jen (Japonia)","code":"JPY","mid":0.025828},{"currency":"korona czeska","code":"CZK","mid":0.1676},{"currency":"korona duńska","code":"DKK","mid":0.5605},{"currency":"korona islandzka","code":"ISK","mid":0.029264},{"currency":"korona norweska","code":"NOK","mid":0.3689},{"currency":"korona szwedzka","code":"SEK","mid":0.3867},{"currency":"lej rumuński","code":"RON","mid":0.8402},{"currency":"lew (Bułgaria)","code":"BGN","mid":2.1381},{"currency":"lira turecka","code":"TRY","mid":0.1017},{"currency":"nowy izraelski szekel","code":"ILS","mid":1.0447},{"currency":"peso chilijskie","code":"CLP","mid":0.004071},{"currency":"peso filipińskie","code":"PHP","mid":0.0675},{"currency":"peso meksykańskie","code":"MXN","mid":0.1885},{"currency":"rand (Republika Południowej Afryki)","code":"ZAR","mid":0.2102},{"currency":"real (Brazylia)","code":"BRL","mid":0.6781},{"currency":"ringgit (Malezja)","code":"MYR","mid":0.8711},{"currency":"rupia indonezyjska","code":"IDR","mid":0.00023343},{"currency":"rupia indyjska","code":"INR","mid":0.045173},{"currency":"won południowokoreański","code":"KRW","mid":0.002627},{"currency":"yuan renminbi (Chiny)","code":"CNY","mid":0.5318},{"currency":"SDR (MFW)","code":"XDR","mid":5.1376}]}
            ])

        nock('https://api.nbp.pl/api/exchangerates/tables/B/?format=json')
            .persist()
            .get(() => true)
            .reply(200, [
                {"table":"B","no":"012/B/NBP/2025","effectiveDate":"2025-03-26","rates":[{"currency":"afgani (Afganistan)","code":"AFN","mid":0.054166},{"currency":"ariary (Madagaskar)","code":"MGA","mid":0.000826},{"currency":"balboa (Panama)","code":"PAB","mid":3.8614},{"currency":"birr etiopski","code":"ETB","mid":0.0294},{"currency":"boliwar soberano (Wenezuela)","code":"VES","mid":0.0563},{"currency":"boliwiano (Boliwia)","code":"BOB","mid":0.5574},{"currency":"colon kostarykański","code":"CRC","mid":0.00774},{"currency":"colon salwadorski","code":"SVC","mid":0.4409},{"currency":"cordoba oro (Nikaragua)","code":"NIO","mid":0.1049},{"currency":"dalasi (Gambia)","code":"GMD","mid":0.0532},{"currency":"denar (Macedonia Północna)","code":"MKD","mid":0.067733},{"currency":"dinar algierski","code":"DZD","mid":0.028815},{"currency":"dinar bahrajski","code":"BHD","mid":10.2385},{"currency":"dinar iracki","code":"IQD","mid":0.002947},{"currency":"dinar jordański","code":"JOD","mid":5.4449},{"currency":"dinar kuwejcki","code":"KWD","mid":12.5183},{"currency":"dinar libijski","code":"LYD","mid":0.7987},{"currency":"dinar serbski","code":"RSD","mid":0.0356},{"currency":"dinar tunezyjski","code":"TND","mid":1.2452},{"currency":"dirham marokański","code":"MAD","mid":0.4031},{"currency":"dirham ZEA (Zjednoczone Emiraty Arabskie)","code":"AED","mid":1.0510},{"currency":"dobra (Wyspy Świętego Tomasza i Książęca)","code":"STN","mid":0.1684},{"currency":"dolar bahamski","code":"BSD","mid":3.8614},{"currency":"dolar barbadoski","code":"BBD","mid":1.9119},{"currency":"dolar belizeński","code":"BZD","mid":1.9218},{"currency":"dolar brunejski","code":"BND","mid":2.8871},{"currency":"dolar Fidżi","code":"FJD","mid":1.6833},{"currency":"dolar gujański","code":"GYD","mid":0.018452},{"currency":"dolar jamajski","code":"JMD","mid":0.0246},{"currency":"dolar liberyjski","code":"LRD","mid":0.0193},{"currency":"dolar namibijski","code":"NAD","mid":0.2115},{"currency":"dolar surinamski","code":"SRD","mid":0.1047},{"currency":"dolar Trynidadu i Tobago","code":"TTD","mid":0.5682},{"currency":"dolar wschodniokaraibski","code":"XCD","mid":1.4276},{"currency":"dolar Wysp Salomona","code":"SBD","mid":0.4681},{"currency":"dong (Wietnam)","code":"VND","mid":0.0001509},{"currency":"dram (Armenia)","code":"AMD","mid":0.009758},{"currency":"escudo Zielonego Przylądka","code":"CVE","mid":0.0376},{"currency":"florin arubański","code":"AWG","mid":2.1328},{"currency":"frank burundyjski","code":"BIF","mid":0.001302},{"currency":"frank CFA BCEAO ","code":"XOF","mid":0.006349},{"currency":"frank CFA BEAC","code":"XAF","mid":0.006268},{"currency":"frank CFP  ","code":"XPF","mid":0.034933},{"currency":"frank Dżibuti","code":"DJF","mid":0.021678},{"currency":"frank gwinejski","code":"GNF","mid":0.000446},{"currency":"frank Komorów","code":"KMF","mid":0.008472},{"currency":"frank kongijski (Dem. Republika Konga)","code":"CDF","mid":0.001347},{"currency":"frank rwandyjski","code":"RWF","mid":0.002741},{"currency":"funt egipski","code":"EGP","mid":0.0764},{"currency":"funt gibraltarski","code":"GIP","mid":4.9843},{"currency":"funt libański","code":"LBP","mid":0.000043},{"currency":"funt południowosudański","code":"SSP","mid":0.000867},{"currency":"funt sudański","code":"SDG","mid":0.006429},{"currency":"funt syryjski","code":"SYP","mid":0.000297},{"currency":"Ghana cedi ","code":"GHS","mid":0.2491},{"currency":"gourde (Haiti)","code":"HTG","mid":0.0294},{"currency":"guarani (Paragwaj)","code":"PYG","mid":0.000482},{"currency":"gulden Antyli Holenderskich","code":"ANG","mid":2.1420},{"currency":"kina (Papua-Nowa Gwinea)","code":"PGK","mid":0.9368},{"currency":"kip (Laos)","code":"LAK","mid":0.000178},{"currency":"kwacha malawijska","code":"MWK","mid":0.002226},{"currency":"kwacha zambijska","code":"ZMW","mid":0.1336},{"currency":"kwanza (Angola)","code":"AOA","mid":0.004191},{"currency":"kyat (Myanmar, Birma)","code":"MMK","mid":0.001838},{"currency":"lari (Gruzja)","code":"GEL","mid":1.3910},{"currency":"lej Mołdawii","code":"MDL","mid":0.2135},{"currency":"lek (Albania)","code":"ALL","mid":0.042214},{"currency":"lempira (Honduras)","code":"HNL","mid":0.1509},{"currency":"leone (Sierra Leone)","code":"SLE","mid":0.1694},{"currency":"lilangeni (Eswatini)","code":"SZL","mid":0.2115},{"currency":"loti (Lesotho)","code":"LSL","mid":0.2115},{"currency":"manat azerbejdżański","code":"AZN","mid":2.2708},{"currency":"metical (Mozambik)","code":"MZN","mid":0.0604},{"currency":"naira (Nigeria)","code":"NGN","mid":0.002511},{"currency":"nakfa (Erytrea)","code":"ERN","mid":0.2561},{"currency":"nowy dolar tajwański","code":"TWD","mid":0.1167},{"currency":"nowy manat (Turkmenistan)","code":"TMT","mid":1.1028},{"currency":"ouguiya (Mauretania)","code":"MRU","mid":0.0967},{"currency":"pa'anga (Tonga)","code":"TOP","mid":1.6033},{"currency":"pataca (Makau)","code":"MOP","mid":0.4816},{"currency":"peso argentyńskie","code":"ARS","mid":0.003606},{"currency":"peso dominikańskie","code":"DOP","mid":0.0611},{"currency":"peso kolumbijskie","code":"COP","mid":0.000941},{"currency":"peso kubańskie","code":"CUP","mid":3.8614},{"currency":"peso urugwajskie","code":"UYU","mid":0.0916},{"currency":"pula (Botswana)","code":"BWP","mid":0.2822},{"currency":"quetzal (Gwatemala)","code":"GTQ","mid":0.5007},{"currency":"rial irański","code":"IRR","mid":0.000092},{"currency":"rial jemeński","code":"YER","mid":0.015687},{"currency":"rial katarski","code":"QAR","mid":1.0589},{"currency":"rial omański","code":"OMR","mid":10.0266},{"currency":"rial saudyjski","code":"SAR","mid":1.0290},{"currency":"riel (Kambodża)","code":"KHR","mid":0.000964},{"currency":"rubel białoruski","code":"BYN","mid":1.2179},{"currency":"rubel rosyjski","code":"RUB","mid":0.0458},{"currency":"rupia lankijska","code":"LKR","mid":0.013031},{"currency":"rupia (Malediwy)","code":"MVR","mid":0.2497},{"currency":"rupia Mauritiusu","code":"MUR","mid":0.0843},{"currency":"rupia nepalska","code":"NPR","mid":0.028144},{"currency":"rupia pakistańska","code":"PKR","mid":0.0138},{"currency":"rupia seszelska","code":"SCR","mid":0.2689},{"currency":"sol (Peru)","code":"PEN","mid":1.0629},{"currency":"som (Kirgistan)","code":"KGS","mid":0.0445},{"currency":"somoni (Tadżykistan)","code":"TJS","mid":0.3540},{"currency":"sum (Uzbekistan)","code":"UZS","mid":0.000299},{"currency":"szyling kenijski","code":"KES","mid":0.029844},{"currency":"szyling somalijski","code":"SOS","mid":0.006754},{"currency":"szyling tanzański","code":"TZS","mid":0.001451},{"currency":"szyling ugandyjski","code":"UGX","mid":0.001053},{"currency":"taka (Bangladesz)","code":"BDT","mid":0.031769},{"currency":"tala (Samoa)","code":"WST","mid":1.3758},{"currency":"tenge (Kazachstan)","code":"KZT","mid":0.007715},{"currency":"tugrik (Mongolia)","code":"MNT","mid":0.001108},{"currency":"vatu (Vanuatu)","code":"VUV","mid":0.031236},{"currency":"wymienialna marka (Bośnia i Hercegowina)","code":"BAM","mid":2.1260},{"currency":"złoto Zimbabwe","code":"ZWG","mid":0.1426}]}
            ])

        nock('https://api.nbp.pl/api/cenyzlota?format=json')
            .persist()
            .get(() => true)
            .reply(200, [{"data":"2025-04-01","cena":387.01}])
    })
})